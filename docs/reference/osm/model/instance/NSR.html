<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NSR</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.29a2c3e4.css" as="style"><link rel="preload" href="/assets/js/app.131032e6.js" as="script"><link rel="preload" href="/assets/js/2.f5d61f7a.js" as="script"><link rel="preload" href="/assets/js/16.5b23cf45.js" as="script"><link rel="prefetch" href="/assets/js/10.268a6dc6.js"><link rel="prefetch" href="/assets/js/11.4c0a7bab.js"><link rel="prefetch" href="/assets/js/12.19d2a09e.js"><link rel="prefetch" href="/assets/js/13.f29b8039.js"><link rel="prefetch" href="/assets/js/14.c835afd8.js"><link rel="prefetch" href="/assets/js/15.a6fef53e.js"><link rel="prefetch" href="/assets/js/17.f4ba404d.js"><link rel="prefetch" href="/assets/js/18.b0515cd3.js"><link rel="prefetch" href="/assets/js/19.4381408a.js"><link rel="prefetch" href="/assets/js/20.6a06c534.js"><link rel="prefetch" href="/assets/js/21.1081aac1.js"><link rel="prefetch" href="/assets/js/22.ee46aed0.js"><link rel="prefetch" href="/assets/js/23.120810af.js"><link rel="prefetch" href="/assets/js/24.8ec3230d.js"><link rel="prefetch" href="/assets/js/25.9320bb42.js"><link rel="prefetch" href="/assets/js/26.977132c8.js"><link rel="prefetch" href="/assets/js/3.597a5b31.js"><link rel="prefetch" href="/assets/js/4.21fd4293.js"><link rel="prefetch" href="/assets/js/5.139dcb5b.js"><link rel="prefetch" href="/assets/js/6.b6cf2c13.js"><link rel="prefetch" href="/assets/js/7.c0fd1940.js"><link rel="prefetch" href="/assets/js/8.6a61df00.js"><link rel="prefetch" href="/assets/js/9.b32a6e74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29a2c3e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/reference/" class="nav-link router-link-active">
  Reference
</a></div><div class="nav-item"><a href="https://osm.etsi.org/docs/user-guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OSM
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/reference/" class="nav-link router-link-active">
  Reference
</a></div><div class="nav-item"><a href="https://osm.etsi.org/docs/user-guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OSM
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/" class="sidebar-heading clickable router-link-active open"><span>文档</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/reference/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/reference/cloud/" class="sidebar-link">CLOUD简介</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/reference/osm/" class="sidebar-heading clickable router-link-active"><span>OSM简介</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nsr"><a href="#nsr" class="header-anchor">#</a> NSR</h1> <h2 id="创建nsr"><a href="#创建nsr" class="header-anchor">#</a> 创建NSR</h2> <div class="language-python extra-class"><pre class="language-python"><code>nsr_descriptor <span class="token operator">=</span> <span class="token punctuation">{</span>
               <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> ns_request<span class="token punctuation">[</span><span class="token string">&quot;nsName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;name-ref&quot;</span><span class="token punctuation">:</span> ns_request<span class="token punctuation">[</span><span class="token string">&quot;nsName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;short-name&quot;</span><span class="token punctuation">:</span> ns_request<span class="token punctuation">[</span><span class="token string">&quot;nsName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;admin-status&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ENABLED&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;nsState&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;NOT_INSTANTIATED&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;currentOperation&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;IDLE&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;currentOperationID&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
               <span class="token string">&quot;errorDescription&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
               <span class="token string">&quot;errorDetail&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
               <span class="token string">&quot;deploymentStatus&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
               <span class="token string">&quot;configurationStatus&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
               <span class="token string">&quot;vcaStatus&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
               <span class="token string">&quot;nsd&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> nsd<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> k <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">&quot;vld&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;constituent-vnfd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
               <span class="token string">&quot;datacenter&quot;</span><span class="token punctuation">:</span> ns_request<span class="token punctuation">[</span><span class="token string">&quot;vimAccountId&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;resource-orchestrator&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;osmopenmano&quot;</span><span class="token punctuation">,</span>
               <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> ns_request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;nsDescription&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">&quot;constituent-vnfr-ref&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

               <span class="token string">&quot;operational-status&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span>    <span class="token comment"># typedef ns-operational-</span>
               <span class="token string">&quot;config-status&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span>         <span class="token comment"># typedef config-states</span>
               <span class="token string">&quot;detailed-status&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;scheduled&quot;</span><span class="token punctuation">,</span>

               <span class="token string">&quot;orchestration-progress&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
               <span class="token comment"># {&quot;networks&quot;: {&quot;active&quot;: 0, &quot;total&quot;: 0}, &quot;vms&quot;: {&quot;active&quot;: 0, &quot;total&quot;: 0}},</span>

               <span class="token string">&quot;create-time&quot;</span><span class="token punctuation">:</span> now<span class="token punctuation">,</span>
               <span class="token string">&quot;nsd-name-ref&quot;</span><span class="token punctuation">:</span> nsd<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;operational-events&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment"># &quot;id&quot;, &quot;timestamp&quot;, &quot;description&quot;, &quot;event&quot;,</span>
               <span class="token string">&quot;nsd-ref&quot;</span><span class="token punctuation">:</span> nsd<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;nsd-id&quot;</span><span class="token punctuation">:</span> nsd<span class="token punctuation">[</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;vnfd-id&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string">&quot;instantiate_params&quot;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_format_ns_request<span class="token punctuation">(</span>ns_request<span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">&quot;additionalParamsForNs&quot;</span><span class="token punctuation">:</span> additional_params<span class="token punctuation">,</span>
               <span class="token string">&quot;ns-instance-config-ref&quot;</span><span class="token punctuation">:</span> nsr_id<span class="token punctuation">,</span>
               <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> nsr_id<span class="token punctuation">,</span>
               <span class="token string">&quot;_id&quot;</span><span class="token punctuation">:</span> nsr_id<span class="token punctuation">,</span>
               <span class="token comment"># &quot;input-parameter&quot;: xpath, value,</span>
               <span class="token string">&quot;ssh-authorized-key&quot;</span><span class="token punctuation">:</span> ns_request<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;ssh_keys&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># TODO remove</span>
           <span class="token punctuation">}</span>
</code></pre></div><h3 id="创建vnfr"><a href="#创建vnfr" class="header-anchor">#</a> 创建VNFR</h3> <p>在数据库中创建好NSR后，根据NSD中的VNFD，创建对应的VNFR</p> <div class="language-python extra-class"><pre class="language-python"><code>vnfr_descriptor <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> vnfr_id<span class="token punctuation">,</span>
                    <span class="token string">&quot;_id&quot;</span><span class="token punctuation">:</span> vnfr_id<span class="token punctuation">,</span>
                    <span class="token string">&quot;nsr-id-ref&quot;</span><span class="token punctuation">:</span> nsr_id<span class="token punctuation">,</span>
                    <span class="token string">&quot;member-vnf-index-ref&quot;</span><span class="token punctuation">:</span> member_vnf<span class="token punctuation">[</span><span class="token string">&quot;member-vnf-index&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;additionalParamsForVnf&quot;</span><span class="token punctuation">:</span> additional_params<span class="token punctuation">,</span>
                    <span class="token string">&quot;created-time&quot;</span><span class="token punctuation">:</span> now<span class="token punctuation">,</span>
                    <span class="token comment"># &quot;vnfd&quot;: vnfd,        # at OSM model.but removed to avoid data duplication TODO: revise</span>
                    <span class="token string">&quot;vnfd-ref&quot;</span><span class="token punctuation">:</span> vnfd_id<span class="token punctuation">,</span>
                    <span class="token string">&quot;vnfd-id&quot;</span><span class="token punctuation">:</span> vnfd<span class="token punctuation">[</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment"># not at OSM model, but useful</span>
                    <span class="token string">&quot;vim-account-id&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;vdur&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;connection-point&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;ip-address&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># mgmt-interface filled by LCM</span>
                <span class="token punctuation">}</span>

<span class="token keyword">for</span> vnfd_vld <span class="token keyword">in</span> vnfd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;internal-vld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    vnfr_descriptor<span class="token punctuation">[</span><span class="token string">&quot;vld&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span> vnfd_vld<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vim-network-name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vim-network-id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">if</span> key <span class="token keyword">in</span> vnfd_vld<span class="token punctuation">}</span><span class="token punctuation">)</span>

vnfd_mgmt_cp <span class="token operator">=</span> vnfd<span class="token punctuation">[</span><span class="token string">&quot;mgmt-interface&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;cp&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> cp <span class="token keyword">in</span> vnfd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;connection-point&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    vnf_cp <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> cp<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">&quot;connection-point-id&quot;</span><span class="token punctuation">:</span> cp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> cp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token comment"># &quot;ip-address&quot;, &quot;mac-address&quot; # filled by LCM</span>
                        <span class="token comment"># vim-id  # TODO it would be nice having a vim port id</span>
            <span class="token punctuation">}</span>
    vnfr_descriptor<span class="token punctuation">[</span><span class="token string">&quot;connection-point&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>vnf_cp<span class="token punctuation">)</span>


<span class="token keyword">for</span> vdu <span class="token keyword">in</span> vnfd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;vdu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    additional_params<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>_format_additional_params<span class="token punctuation">(</span>ns_request<span class="token punctuation">,</span> member_vnf<span class="token punctuation">[</span><span class="token string">&quot;member-vnf-index&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                                          vdu_id<span class="token operator">=</span>vdu<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> descriptor<span class="token operator">=</span>vnfd<span class="token punctuation">)</span>
    vdur <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;vdu-id-ref&quot;</span><span class="token punctuation">:</span> vdu<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment"># TODO      &quot;name&quot;: &quot;&quot;     Name of the VDU in the VIM</span>
        <span class="token string">&quot;ip-address&quot;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># mgmt-interface filled by LCM</span>
        <span class="token comment"># &quot;vim-id&quot;, &quot;flavor-id&quot;, &quot;image-id&quot;, &quot;management-ip&quot; # filled by LCM</span>
        <span class="token string">&quot;internal-connection-point&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;interfaces&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;additionalParams&quot;</span><span class="token punctuation">:</span> additional_params
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> vdu<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;pdu-type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        vdur<span class="token punctuation">[</span><span class="token string">&quot;pdu-type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> vdu<span class="token punctuation">[</span><span class="token string">&quot;pdu-type&quot;</span><span class="token punctuation">]</span>
    <span class="token comment"># TODO volumes: name, volume-id</span>
    <span class="token keyword">for</span> icp <span class="token keyword">in</span> vdu<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;internal-connection-point&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        vdu_icp <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> icp<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">&quot;connection-point-id&quot;</span><span class="token punctuation">:</span> icp<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> icp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment"># &quot;ip-address&quot;, &quot;mac-address&quot; # filled by LCM</span>
            <span class="token comment"># vim-id  # TODO it would be nice having a vim port id</span>
        <span class="token punctuation">}</span>
        vdur<span class="token punctuation">[</span><span class="token string">&quot;internal-connection-point&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>vdu_icp<span class="token punctuation">)</span>
        <span class="token keyword">for</span> iface <span class="token keyword">in</span> vdu<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;interface&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            vdu_iface <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> iface<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment"># &quot;ip-address&quot;, &quot;mac-address&quot; # filled by LCM</span>
                <span class="token comment"># vim-id  # TODO it would be nice having a vim port id</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> vnfd_mgmt_cp <span class="token keyword">and</span> iface<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;external-connection-point-ref&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> vnfd_mgmt_cp<span class="token punctuation">:</span>
                vdu_iface<span class="token punctuation">[</span><span class="token string">&quot;mgmt-vnf&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">if</span> iface<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;mgmt-interface&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                vdu_iface<span class="token punctuation">[</span><span class="token string">&quot;mgmt-interface&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># TODO change to mgmt-vdu</span>

            <span class="token comment"># look for network where this interface is connected</span>
            <span class="token keyword">if</span> iface<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;external-connection-point-ref&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> nsd_vld <span class="token keyword">in</span> get_iterable<span class="token punctuation">(</span>nsd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;vld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> nsd_vld_cp <span class="token keyword">in</span> get_iterable<span class="token punctuation">(</span>nsd_vld<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;vnfd-connection-point-ref&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> nsd_vld_cp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;vnfd-connection-point-ref&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> iface<span class="token punctuation">[</span><span class="token string">&quot;external-connection-point-ref&quot;</span><span class="token punctuation">]</span> <span class="token keyword">and</span> \
                            nsd_vld_cp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;member-vnf-index-ref&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> member_vnf<span class="token punctuation">[</span><span class="token string">&quot;member-vnf-index&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                vdu_iface<span class="token punctuation">[</span><span class="token string">&quot;ns-vld-id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> nsd_vld<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span>
                                <span class="token keyword">break</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token keyword">continue</span>
                <span class="token keyword">break</span>
            <span class="token keyword">elif</span> iface<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;internal-connection-point-ref&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> vnfd_ivld <span class="token keyword">in</span> get_iterable<span class="token punctuation">(</span>vnfd<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;internal-vld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> vnfd_ivld_icp <span class="token keyword">in</span> get_iterable<span class="token punctuation">(</span>vnfd_ivld<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;internal-connection-point&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> vnfd_ivld_icp<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;id-ref&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> iface<span class="token punctuation">[</span><span class="token string">&quot;internal-connection-point-ref&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            vdu_iface<span class="token punctuation">[</span><span class="token string">&quot;vnf-vld-id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> vnfd_ivld<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span>
                            <span class="token keyword">break</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token keyword">continue</span>
                <span class="token keyword">break</span>

            vdur<span class="token punctuation">[</span><span class="token string">&quot;interfaces&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>vdu_iface<span class="token punctuation">)</span>
            count <span class="token operator">=</span> vdu<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> count <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                count <span class="token operator">=</span> <span class="token number">1</span>
            count <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>    <span class="token comment"># TODO remove when descriptor serialized with payngbind</span>
            <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> index<span class="token punctuation">:</span>
                    vdur <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>vdur<span class="token punctuation">)</span>
                vdur<span class="token punctuation">[</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                vdur<span class="token punctuation">[</span><span class="token string">&quot;count-index&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> index
                vnfr_descriptor<span class="token punctuation">[</span><span class="token string">&quot;vdur&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>vdur<span class="token punctuation">)</span>
</code></pre></div><h2 id="创建新的lcm操作"><a href="#创建新的lcm操作" class="header-anchor">#</a> 创建新的lcm操作</h2></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.131032e6.js" defer></script><script src="/assets/js/2.f5d61f7a.js" defer></script><script src="/assets/js/16.5b23cf45.js" defer></script>
  </body>
</html>

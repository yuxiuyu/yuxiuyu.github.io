(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{375:function(t,v,_){"use strict";_.r(v);var d=_(42),a=Object(d.a)({},(function(){var t=this,v=t.$createElement,_=t._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"new-vnfd-v3方法解析"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#new-vnfd-v3方法解析"}},[t._v("#")]),t._v(" new_vnfd_v3方法解析")]),t._v(" "),_("h2",{attrs:{id:"参数说明"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),_("p",[t._v("new_vnfd_v3方法接受三个参数，分别")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("参数名")]),t._v(" "),_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("说明")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("mydb")]),t._v(" "),_("td"),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("tenant_id")]),t._v(" "),_("td"),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("vnf_descriptor")]),t._v(" "),_("td"),t._v(" "),_("td")])])]),t._v(" "),_("h2",{attrs:{id:"return"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#return"}},[t._v("#")]),t._v(" return")]),t._v(" "),_("p",[t._v("返回创建的VNFD的ids列表(即vnfd_uuid_list)")]),t._v(" "),_("h2",{attrs:{id:"创建流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#创建流程"}},[t._v("#")]),t._v(" 创建流程")]),t._v(" "),_("p",[t._v("首先通过vnfd_catalog.vnfd()创建了一个vnfd模型")]),t._v(" "),_("div",{staticClass:"language-python extra-class"},[_("pre",{pre:!0,attrs:{class:"language-python"}},[_("code",[t._v("myvnfd "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnfd_catalog"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vnfd"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),_("p",[t._v("通过pyangbind将传过来的vnf_descriptor解析成json格式并赋值给myvnfd")]),t._v(" "),_("p",[t._v("然后定义了一系列的数组，来存放相关对象")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("数组名")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("db_vnfs")]),t._v(" "),_("td",[t._v("vnf对象数组")])]),t._v(" "),_("tr",[_("td",[t._v("db_ip_profiles")]),t._v(" "),_("td",[t._v("ip_profiles")])]),t._v(" "),_("tr",[_("td",[t._v("db_nets")]),t._v(" "),_("td",[t._v("net")])]),t._v(" "),_("tr",[_("td",[t._v("db_vms")]),t._v(" "),_("td",[t._v("vdu")])]),t._v(" "),_("tr",[_("td",[t._v("db_interfaces")]),t._v(" "),_("td",[t._v("interface")])]),t._v(" "),_("tr",[_("td",[t._v("db_images")]),t._v(" "),_("td",[t._v("image")])]),t._v(" "),_("tr",[_("td",[t._v("db_flavors")]),t._v(" "),_("td",[t._v("flavor")])])])]),t._v(" "),_("h3",{attrs:{id:"vnf"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#vnf"}},[t._v("#")]),t._v(" vnf")]),t._v(" "),_("p",[t._v("通过myvnfd.vnfd_catalog.vnfd.values()循环获取vnfd_yang")]),t._v(" "),_("p",[t._v("定义一个数组"),_("code",[t._v("vnfd_descriptor_list")]),t._v(' 来存放从vnfd_catalog_descriptor.get("vnfd:vnfd")获取到的list')]),t._v(" "),_("p",[t._v("定义一个"),_("code",[t._v("vnfd")]),t._v(" = vnfd_yang.get()")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("变量名")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("uuid")]),t._v(" "),_("td",[t._v("uuid4()随机数")])]),t._v(" "),_("tr",[_("td",[t._v("osm_id")]),t._v(" "),_("td",[t._v("vnfd.id")])]),t._v(" "),_("tr",[_("td",[t._v("name")]),t._v(" "),_("td",[t._v("vnfd.name")])]),t._v(" "),_("tr",[_("td",[t._v("description")]),t._v(" "),_("td",[t._v("vnfd.description")])]),t._v(" "),_("tr",[_("td",[t._v("tenant_id")]),t._v(" "),_("td",[t._v("传入的tenant_id")])]),t._v(" "),_("tr",[_("td",[t._v("vendor")]),t._v(" "),_("td",[t._v("vnfd.vendor")])]),t._v(" "),_("tr",[_("td",[t._v("short_name")]),t._v(" "),_("td",[t._v("vnfd.short_name")])]),t._v(" "),_("tr",[_("td",[t._v("descriptor")]),t._v(" "),_("td",[t._v("传入的vnfd_descriptor")])]),t._v(" "),_("tr",[_("td",[t._v("mgmt_access")]),t._v(" "),_("td")])])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("vnfd_uuid_list.append(uuid) 这就是最后返回的uuid列表\nuuid_list.append(uuid)\n")])])]),_("h4",{attrs:{id:"ip-profile"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ip-profile"}},[t._v("#")]),t._v(" ip_profile")]),t._v(" "),_("p",[t._v("可以设置一些子网的细节")]),t._v(" "),_("ol",[_("li",[t._v("在"),_("code",[t._v("vnfd_descriptor_list")]),t._v("列表里寻找id与vnfd.id相等的"),_("code",[t._v("vnfd_descriptor")])]),t._v(" "),_("li",[t._v('通过vnfd.get("ip-profiles")循环获取'),_("code",[t._v("ip_profile")])]),t._v(" "),_("li",[t._v("定义params = ip_profile.ip-profile-params")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("字段")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("ip_version")]),t._v(" "),_("td",[t._v("params.ip-version+params.ipv4")])]),t._v(" "),_("tr",[_("td",[t._v("subnet_address")]),t._v(" "),_("td",[t._v("params.subnet-address")])]),t._v(" "),_("tr",[_("td",[t._v("gateway_address")]),t._v(" "),_("td",[t._v("params.gateway-address")])]),t._v(" "),_("tr",[_("td",[t._v("dhcp_enabled")]),t._v(" "),_("td",[t._v("params.dhcp-params.enabled")])]),t._v(" "),_("tr",[_("td",[t._v("dhcp_start_address")]),t._v(" "),_("td",[t._v("params.dhcp-params.start-address")])]),t._v(" "),_("tr",[_("td",[t._v("dhcp_count")]),t._v(" "),_("td",[t._v("params.dhcp-params.count")])]),t._v(" "),_("tr",[_("td",[t._v("dns_address")]),t._v(" "),_("td",[t._v("params.dns-server数组通过“；”连接的字符串")])]),t._v(" "),_("tr",[_("td",[t._v("security_group")]),t._v(" "),_("td",[t._v("有params.security-group话")])]),t._v(" "),_("tr",[_("td",[t._v("net_id")]),t._v(" "),_("td",[t._v("net_uuid")])])])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v('ip_profile_name2db_table_index[str(ip_profile["name"])] = db_ip_profiles_index\ndb_ip_profiles_index += 1\n')])])]),_("h4",{attrs:{id:"net"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#net"}},[t._v("#")]),t._v(" net")]),t._v(" "),_("ol",[_("li",[t._v('通过vnfd.get("internal-vld")循环获取'),_("code",[t._v("vld")])])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("字段")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("name")]),t._v(" "),_("td",[t._v("vld.name")])]),t._v(" "),_("tr",[_("td",[t._v("vnf_id")]),t._v(" "),_("td",[t._v("关联vnf.uuid")])]),t._v(" "),_("tr",[_("td",[t._v("uuid")]),t._v(" "),_("td",[t._v("uuid4()随机数")])]),t._v(" "),_("tr",[_("td",[t._v("description")]),t._v(" "),_("td",[t._v("vld.description")])]),t._v(" "),_("tr",[_("td",[t._v("osm_id")]),t._v(" "),_("td",[t._v("vld.id")])]),t._v(" "),_("tr",[_("td",[t._v("type")]),t._v(" "),_("td",[t._v('"bridge"  #depending on connection point type')])])])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("uuid_list.append(uuid)\n")])])]),_("p",[t._v("关联 db_ip_profile with db_sce_net")]),t._v(" "),_("ol",[_("li",[_("p",[t._v("如果vld中存在"),_("code",[t._v("ip-profile-ref")]),t._v("："),_("code",[t._v("ip_profile_name")])]),t._v(" "),_("p",[t._v("如果在ip_profile_name2db_table_index没发现"),_("code",[t._v("ip_profile_name")]),t._v("则返回")]),t._v(" "),_("p",[t._v("如果发现的话则更新ip_profile.net_id = net.uuid")])]),t._v(" "),_("li",[_("p",[t._v("如果vld中不存在"),_("code",[t._v("ip-profile-ref")]),t._v("，则去检查没有定义ip-address")]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v('for icp in vld.get("internal-connection-point").values():\n')])])]),_("p",[t._v("如果icp中存在ip-address，则返回")])])]),t._v(" "),_("h4",{attrs:{id:"vdu"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#vdu"}},[t._v("#")]),t._v(" vdu")]),t._v(" "),_("p",[t._v('通过vnfd.get("vdu")循环获取vdu')]),t._v(" "),_("p",[t._v("在vnfd_descriptor.vdu列表里寻找id与vdu.id相等的"),_("code",[t._v("vdu_descriptor")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("字段")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("uuid")]),t._v(" "),_("td",[t._v("uuid4()随机数")])]),t._v(" "),_("tr",[_("td",[t._v("osm.id")]),t._v(" "),_("td",[t._v("vdu.id")])]),t._v(" "),_("tr",[_("td",[t._v("name")]),t._v(" "),_("td",[t._v("vdu.name")])]),t._v(" "),_("tr",[_("td",[t._v("description")]),t._v(" "),_("td",[t._v("vdu.description")])]),t._v(" "),_("tr",[_("td",[t._v("pdu_type")]),t._v(" "),_("td",[t._v("vdu.pdu_type")])]),t._v(" "),_("tr",[_("td",[t._v("vnf_id")]),t._v(" "),_("td",[t._v("关联vnf.uuid")])]),t._v(" "),_("tr",[_("td",[t._v("count")]),t._v(" "),_("td",[t._v("如果有vdu.count")])]),t._v(" "),_("tr",[_("td",[t._v("flavor_id")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("image_id")]),t._v(" "),_("td",[t._v("如果有vdu.image则去查找image_uuid，没找到image_uuid，就新建image_uuid，过程见下方")])]),t._v(" "),_("tr",[_("td",[t._v("image_list")]),t._v(" "),_("td",[t._v("数组里面放的对象，见下方")])]),t._v(" "),_("tr",[_("td",[t._v("boot_data")]),t._v(" "),_("td",[t._v("见cloud-init")])])])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("uuid_list.append(uuid)\n")])])]),_("h5",{attrs:{id:"image"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#image"}},[t._v("#")]),t._v(" image")]),t._v(" "),_("p",[t._v('1、如果存在vdu.get("image")则去查找？获取image_uuid')]),t._v(" "),_("p",[t._v("如果没有获取到image_uuid")]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v('image_uuid = db_image["uuid"]\ndb_images.append(db_image)\n')])])]),_("p",[t._v("最后vdu.image_id=image_uuid")]),t._v(" "),_("p",[t._v('2、如果存在vdu.get("alternative-images")，与上方image过程相同')]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v('最后vdu.image_list = [{\n                        "image_id": image_uuid,\n                        "vim_type": str(alt_image["vim-type"]),\n                  }]\n')])])]),_("table",[_("thead",[_("tr",[_("th",[t._v("字段")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("name")]),t._v(" "),_("td",[t._v("descriptor.image")])]),t._v(" "),_("tr",[_("td",[t._v("checksum")]),t._v(" "),_("td",[t._v("descriptor.image-checksum")])]),t._v(" "),_("tr",[_("td",[t._v("location")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("universal_name")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("uuid")]),t._v(" "),_("td",[t._v("uuid4()随机数(当数据库没找到这个image)")])])])]),t._v(" "),_("p",[t._v("3、volumes")]),t._v(" "),_("p",[t._v('如果存在vdu.get("volumes")，通过vdu.get("volumes")循环获取volume')]),t._v(" "),_("p",[t._v('如果不存在vdu.get("image")，则和步骤一一样')]),t._v(" "),_("p",[t._v('如果不存在vdu.get("image")，则Add Openmano devices')]),t._v(" "),_("h5",{attrs:{id:"cloud-init"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#cloud-init"}},[t._v("#")]),t._v(" cloud-init")]),t._v(" "),_("p",[t._v("Cloud-init通常用于Day-0操作，例如：")]),t._v(" "),_("ul",[_("li",[t._v("设置默认语言环境")]),t._v(" "),_("li",[t._v("设置实例主机名")]),t._v(" "),_("li",[t._v("生成实例SSH私钥或定义密码")]),t._v(" "),_("li",[t._v("将SSH密钥添加到用户的.ssh / authorized_keys中，以便他们可以登录")]),t._v(" "),_("li",[t._v("设置临时挂载点")]),t._v(" "),_("li",[t._v("配置网络设备")]),t._v(" "),_("li",[t._v("添加用户和组")]),t._v(" "),_("li",[t._v("添加文件")])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("boot_data = {}\n")])])]),_("p",[t._v("对于内部cloud-init定义cloud-init")]),t._v(" "),_("p",[t._v("boot_data.user-data = vdu.cloud-init")]),t._v(" "),_("p",[t._v("对于外部cloud-init定义cloud-init-file")]),t._v(" "),_("p",[t._v("boot_data.user-data = vdu.cloud-init-file")]),t._v(" "),_("p",[t._v("支持配置驱动器")]),t._v(" "),_("p",[t._v("如果存在vdu.supplemental-boot-data.boot-data-drive")]),t._v(" "),_("p",[t._v("boot_data.boot-data-drive = true")]),t._v(" "),_("p",[t._v("boot_data.config-files?")]),t._v(" "),_("h5",{attrs:{id:"interface"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#interface"}},[t._v("#")]),t._v(" interface")]),t._v(" "),_("p",[t._v('通过vdu.get("interface")循环获取iface')]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("字段")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("uuid")]),t._v(" "),_("td",[t._v("uuid4()随机数")])]),t._v(" "),_("tr",[_("td",[t._v("internal_name")]),t._v(" "),_("td",[t._v("iface.name")])]),t._v(" "),_("tr",[_("td",[t._v("vm_id")]),t._v(" "),_("td",[t._v("vdu.id")])]),t._v(" "),_("tr",[_("td",[t._v("vpci")]),t._v(" "),_("td",[t._v('判iface.get("virtual-interface").get("vpci")')])]),t._v(" "),_("tr",[_("td",[t._v("bw")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("type")]),t._v(" "),_("td",[t._v("mgmt/bridge/data")])]),t._v(" "),_("tr",[_("td",[t._v("model")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("external_name")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("port_security")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("net_id")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("ip_address")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("created_at")]),t._v(" "),_("td",[t._v('判int(interface.get("position")) * 50')])]),t._v(" "),_("tr",[_("td",[t._v("mac")]),t._v(" "),_("td",[t._v('判interface.get("mac-address")')])]),t._v(" "),_("tr",[_("td"),t._v(" "),_("td")])])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("uuid_list.append(uuid)\n")])])]),_("h5",{attrs:{id:"flavor"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#flavor"}},[t._v("#")]),t._v(" flavor")]),t._v(" "),_("p",[t._v("通过vdu.vm-flavor获取flavor")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("字段")]),t._v(" "),_("th",[t._v("描述")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("name")]),t._v(" "),_("td",[t._v('vdu.name+"-flv"')])]),t._v(" "),_("tr",[_("td",[t._v("vcpus")]),t._v(" "),_("td",[t._v("flavor.vcpu-count")])]),t._v(" "),_("tr",[_("td",[t._v("ram")]),t._v(" "),_("td",[t._v("flavor.memory-mb")])]),t._v(" "),_("tr",[_("td",[t._v("disk")]),t._v(" "),_("td",[t._v("flavor.storage-gb")])]),t._v(" "),_("tr",[_("td",[t._v("extended")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("uuid")]),t._v(" "),_("td")])])]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("uuid_list.append(uuid)\n")])])]),_("h2",{attrs:{id:"最后"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("mydb.new_rows(db_tables, uuid_list)\n")])])])])}),[],!1,null,null,null);v.default=a.exports}}]);